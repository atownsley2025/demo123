<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Endless Impossible Game</title>
<style>
  body{margin:0;background:#0f1226;color:#eee;font-family:sans-serif;display:flex;flex-direction:column;align-items:center}
  canvas{background:#0b0f27;border:2px solid #262a54;border-radius:12px;box-shadow:0 10px 30px #0008}
  #hud{margin:10px;font-size:18px}
  button{margin:6px;padding:10px 14px;border-radius:8px;border:none;background:#1b1e3f;color:#eee;font-weight:600;cursor:pointer}
</style>
</head>
<body>
<h2>The Impossible Endless Game</h2>
<div id="hud">Level: <span id="lvl">1</span> · Attempts: <span id="tries">0</span> · Jumps: <span id="jumps">0</span></div>
<canvas id="game" width="800" height="400"></canvas>
<button id="btnStart">▶ Start</button>
<script>
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");
const hudLvl=document.getElementById("lvl");
const hudTries=document.getElementById("tries");
const hudJumps=document.getElementById("jumps");
const btnStart=document.getElementById("btnStart");

const GROUND_Y=340;
let STATE="idle";
let attemptCount=0;
let jumpCount=0;
let level=1;

const player={x:80,y:GROUND_Y-28,w:26,h:26,vy:0,onGround:true,jumpsLeft:2,maxJumps:2};
const input={justPressed:false};
const gravity=0.6;
let speed=4.0;
let obstacles=[]; // spawn list
let spawnTimer=0;
const COLORS={player:"#8ef",obstacle:"#ff4d6d",ground:"#1c2045"};

function pressJump(){input.justPressed=true;}
window.addEventListener("keydown",e=>{
  if(["Space","ArrowUp","KeyW"].includes(e.code)){e.preventDefault();pressJump();}
});
canvas.addEventListener("pointerdown",pressJump);

btnStart.onclick=()=>{resetGame();STATE="running";};

function resetGame(){
  attemptCount=0;jumpCount=0;level=1;
  hudTries.textContent=attemptCount;
  hudJumps.textContent=jumpCount;
  hudLvl.textContent=level;
  obstacles=[];
  resetPlayer();
}

function resetPlayer(){
  Object.assign(player,{x:80,y:GROUND_Y-28,vy:0,onGround:true,jumpsLeft:2});
}

function rectIntersect(a,b){return a.x<b.x+b.w && a.x+a.w>b.x && a.y<b.y+b.h && a.y+a.h>b.y;}

function update(){
  if(STATE!=="running")return;
  // spawn new obstacles
  spawnTimer-=speed;
  if(spawnTimer<=0){
    const h=40+Math.random()*60;
    obstacles.push({x:canvas.width+40,y:GROUND_Y-h,w:20+Math.random()*20,h:h});
    spawnTimer=200+Math.random()*200;
  }

  // move obstacles
  for(const o of obstacles){o.x-=speed;}
  obstacles=obstacles.filter(o=>o.x+o.w>0);

  // physics
  player.vy+=gravity;
  if(input.justPressed && player.jumpsLeft>0){
    player.vy=-12;
    player.onGround=false;
    player.jumpsLeft--;
    jumpCount++;
    hudJumps.textContent=jumpCount;
    if(jumpCount%10===0){ // every 10 jumps, level up
      level++;
      hudLvl.textContent=level;
      speed+=0.3; // harder
    }
  }
  input.justPressed=false;

  player.y+=player.vy;
  if(player.y+player.h>=GROUND_Y){
    player.y=GROUND_Y-player.h;
    player.vy=0;
    if(!player.onGround){
      player.onGround=true;
      player.jumpsLeft=player.maxJumps;
    }
  }else{player.onGround=false;}

  // collisions
  for(const o of obstacles){
    if(rectIntersect(player,o)){
      attemptCount++;
      hudTries.textContent=attemptCount;
      resetPlayer();
      obstacles=[];
      spawnTimer=0;
      speed=4.0+0.3*(level-1);
      break;
    }
  }
}

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle=COLORS.ground;
  ctx.fillRect(0,GROUND_Y,canvas.width,canvas.height-GROUND_Y);

  ctx.fillStyle=COLORS.obstacle;
  for(const o of obstacles){ctx.fillRect(o.x,o.y,o.w,o.h);}
  ctx.fillStyle=COLORS.player;
  ctx.fillRect(player.x,player.y,player.w,player.h);
}

function loop(){
  update();
  draw();
  requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
